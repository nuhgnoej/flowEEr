# FlowEEr – 온디바이스 앱 프로젝트 (MVP)

## 🏗️ 프로젝트 개요

**FlowEEr는 시간의 흐름을 설계하고 실행하는 루틴 자동화 도구입니다.**  
이번 버전은 **서버 없이 온디바이스에서만 작동하는 경량 버전(MVP)**으로 개발됩니다.

---

## 🚀 프로젝트 핵심 개념

### ✔️ 핵심 개념

- **플로우(Flow)** → 하나의 루틴 (출근 준비, 운동 루틴 등)
- **스텝(Step)** → 플로우 안의 단일 행동/시간 단위 (예: 기상, 씻기, 출발)
- **트리거(Trigger)** → 이전 스텝으로부터 시간 오프셋으로 다음 스텝이 실행되는 관계

### ✔️ 작동 원리

- 기준 스텝(예: 기상) 시간 설정
- 이후 스텝들은 **“기준 스텝 + 오프셋”** 방식으로 자동 시간 계산
- 트리거 체인 방식으로 알람 실행

---

## 🧠 기능 스코프 (온디바이스 버전)

| 기능                    | 상태                         |
| ----------------------- | ---------------------------- |
| 플로우 생성/관리        | ✅ 지원                      |
| 스텝 추가/편집          | ✅ 지원                      |
| 시간 오프셋 기반 트리거 | ✅ 지원                      |
| 로컬 알람 실행          | ✅ 지원 (expo-notifications) |
| 푸시 알림               | ❌ 미지원 (서버 없음)        |
| 클라우드 동기화         | ❌ 미지원 (온디바이스 전용)  |

---

## 📚 Trigger Types 정의

### 트리거는 특정 스텝이 실행되는 조건을 정의합니다.

한 스텝은 다수의 트리거를 가질 수 있으며, 모든 트리거 중 하나라도 충족되면 해당 스텝이 실행됩니다.

---

## 🔗 Trigger Type 목록

| 타입                  | 설명                                     | 필드                                   |
| --------------------- | ---------------------------------------- | -------------------------------------- |
| **`at_time`**         | 특정 절대 시간에 실행 (단독 알람 트리거) | `time` (필수), `offset` (선택)         |
| **`after_step`**      | 특정 스텝이 완료된 후 실행               | `targetStepId` (필수), `offset` (선택) |
| **`delay_from_step`** | 특정 스텝이 시작된 지 X초 후 실행        | `targetStepId` (필수), `offset` (필수) |
| **`manual`**          | 수동 실행 (앱에서 사용자가 직접 실행)    | 없음                                   |
| **`immediate`**       | 특정 스텝이 완료된 직후 즉시 실행        | `targetStepId` (필수)                  |
| **`after_all`**       | 플로우 내 모든 스텝이 완료된 후 실행     | 없음                                   |

---

## 🔥 필드 설명

| 필드           | 설명                                                  |
| -------------- | ----------------------------------------------------- |
| `targetStepId` | 트리거가 의존하는 스텝의 ID (없으면 null → 시간 기반) |
| `type`         | 트리거 타입 (`at_time`, `after_step`, ...)            |
| `offset`       | 지연 시간 (초 단위, 선택적)                           |
| `time`         | `at_time` 타입에서 사용하는 절대 시간 (`HH:mm` 포맷)  |

---

## 🚩 동작 원리

- 트리거 배열 중 **하나라도 조건을 만족하면 스텝이 실행됩니다.**
- `at_time` 트리거는 단독 알람 트리거로 동작합니다.
- `after_step` 또는 `delay_from_step`은 스텝 간의 연쇄적 실행을 만듭니다.
- `manual`은 앱에서 사용자가 직접 실행합니다.
- `after_all`은 플로우 전체 완료 후 실행되는 후처리 트리거입니다.

---

## 🏗️ 예시

```json
{
  "id": 1,
  "name": "아침 준비",
  "triggers": [
    {
      "type": "at_time",
      "time": "07:00"
    }
  ]
},
{
  "id": 2,
  "name": "양치",
  "triggers": [
    {
      "type": "after_step",
      "targetStepId": 1,
      "offset": 60
    }
  ]
},
{
  "id": 3,
  "name": "세안",
  "triggers": [
    {
      "type": "immediate",
      "targetStepId": 2
    }
  ]
}
```

---

## 🔥 기술 스택

| 영역         | 스택                                       |
| ------------ | ------------------------------------------ |
| 프레임워크   | **React Native + Expo (파일 기반 라우팅)** |
| 데이터베이스 | **SQLite (expo-sqlite)**                   |
| 상태 관리    | React Context / Zustand (추후 결정)        |
| 알람         | **expo-notifications (로컬 알람)**         |
| 스토리지     | AsyncStorage / FileSystem (보조 데이터)    |

---

## 🗂️ 폴더 구조

```plaintext
app/
├── (tabs)/            ✅ 메인 탭 그룹
│   ├── index.tsx      // 홈 대시보드
│   ├── flow.tsx       // 플로우 목록
│   ├── step.tsx       // 스텝(스케줄) 목록
│   ├── settings.tsx   // 설정
│   └── _layout.tsx    // 탭 네비게이션
├── flow/
│   ├── [id].tsx       // 플로우 상세/편집
│   └── newFlow.tsx        // 플로우 생성
db/                     ✅ SQLite 모델, 쿼리
lib/                    ✅ 시간 계산, 트리거 유틸
components/             ✅ 재사용 UI
hooks/                  ✅ 상태 관리 훅
```

---

## 🎯 향후 확장 계획

- 웹 버전 추가 (Next.js 기반 루틴 빌더)
- 서버 연동 (Supabase 또는 Node.js API)
- 푸시 알림 지원 (Expo Push Notification + 서버)
- 사용자 계정 및 동기화 기능 추가
- 클라우드 백업 및 멀티 디바이스 지원

---

## 💡 프로젝트 비전

> **“시간을 설계하고, 흐름을 만들고, 삶을 피워낸다.”**

---

## ✅ 현재 개발 목표

1. 온디바이스에서 완전 작동 가능한 FlowEEr 앱 구현
2. 플로우 생성 → 스텝 연결 → 시간 트리거 → 로컬 알람 작동 흐름 완성
3. 향후 서버 및 웹 확장을 위한 코드 아키텍처 미리 고려

---
